<html>
  <head>
    <script>
      function promise1() {
        return new Promise((res, rej) => {
          setTimeout(() => {
            res("Resolved after 5seconds");
            // rej("Rejected after 5seconds");
          }, 5000);
        });
      }

      function promise2() {
        return new Promise((res, rej) => {
          setTimeout(() => {
            // res("Resolved after 3seconds");
            rej("Rejected after 3seconds");
          }, 3000);
        });
      }

      function promise3() {
        return new Promise((res, rej) => {
          setTimeout(() => {
            res("Resolved after a second");
            // rej("Rejected after a second");
          }, 1000);
        });
      }

      function promiseAll() {
        const check = Promise.all([promise1(), promise2(), promise3()])
          .then((result) => {
            for (let res of result) {
              console.log(res);
            }
          })
          .catch((error) => {
            // for (let err in error) {
            console.log("error ", error);
            // }
          });
        // console.log("Check " + check);
      }

      function promiseAllSettled() {
        Promise.allSettled([promise1(), promise2(), promise3()]).then(
          (resp) => {
            for (let res of resp) {
              console.log(res.value || res.reason);
            }
          }
        );
      }

      function promiseRace() {
        Promise.race([promise1(), promise2(), promise3()])
          .then((resp) => {
            console.log(resp);
          })
          .catch((error) => {
            console.log(error);
          });
      }

      function promiseAny() {
        Promise.any([promise1(), promise2(), promise3()])
          .then((resp) => {
            console.log(resp);
          })
          .catch((error) => {
            // console.log(error);
            for (let err of error.errors) {
              console.log(err);
            }
          });
      }

      function promiseAllPolifyl(arr) {
        let result = [];
        let responseCounter = 0;

        // throw new Error("check hello"); //this also won't be caught at .catch of caller function
        // return Promise.reject(new Error("check error catch")); // this will be caught

        return new Promise((resolve, reject) => {
          for (let promise of arr) {
            promise()
              .then((resp) => {
                result.push(resp);
                responseCounter++;

                if (responseCounter === arr.length) {
                  resolve(result);
                }
              })
              .catch((e) => {
                // throw e; // throw does not work, it should be handled by reject as this .catch at caller level expects asyncly thrown errors
                // Because .catch() only catches Promise rejections, not synchronous exceptions thrown before a Promise exists.
                reject(e);
              });
          }
        });
      }

      //   promiseAll();

      promiseAllPolifyl([promise1, promise2, promise3])
        .then((res) => {
          for (let item of res) {
            console.log(item);
          }
        })
        .catch((e) => {
          console.log("caller catch", e);
          return 4;
        })
        .finally((value) => {
          console.log(value); //does not work
          // 1. does not receive the resolved value
          // 2. does not receive the rejection reason
          // 3. runs purely for side effects
          // 4. passes through the previous state unchanged
        })
        .then((value) => {
          console.log(value); //here it get received
          throw "check this is caught or not";
        })
        .catch((e) => {
          console.log("This is caught here ", e);
        });

      //   promiseAllSettled();
      //   promiseRace();
      //   promiseAny();
    </script>
  </head>
  <body></body>
</html>
